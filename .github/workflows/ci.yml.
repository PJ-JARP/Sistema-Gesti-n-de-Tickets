name: Java CI/CD Workflow

on:
  push:
    branches:
      - develop  # Rama de desarrollo principal
      - Registro_de_tickets_con_datos_relevantes  # Rama específica para registro de tickets
      - master  # Rama principal para producción
      - main  # Otra rama principal si la usas (algunos repositorios usan esta en lugar de master)
  pull_request:
    branches:
      - develop  # También se ejecuta para pull requests hacia 'develop'
      - Registro_de_tickets_con_datos_relevantes
      - master
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Descarga el código del repositorio
      - name: Check out repository
        uses: actions/checkout@v2

      # Configura JDK 22
      - name: Set up JDK 22
        uses: actions/setup-java@v2
        with:
          java-version: '22.0.2'  # Versión de Java actualizada a 22.0.2
          distribution: 'temurin'  # Puedes cambiar esto si usas una distribución diferente

      # Cachea las dependencias de Maven para construcciones más rápidas
      - name: Cache Maven dependencies
        uses: actions/cache@v3
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            ${{ runner.os }}-maven

      # Construye el proyecto con Maven
      - name: Build with Maven
        run: mvn clean install

      # Ejecuta las pruebas unitarias
      - name: Run tests
        run: mvn test

      # En caso de errores, muestra logs adicionales (opcional)
      - name: Show Maven Logs (on failure)
        if: failure()
        run: cat target/surefire-reports/*.txt || echo "No logs found"
